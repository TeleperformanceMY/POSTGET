<!DOCTYPE html>
<html>
<head>
  <title>Check Application Status</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 10px; margin: 5px; width: 250px; }
    #result { margin-top: 20px; }
    .entry { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Check Your Application</h2>
  
  <input type="email" id="email" placeholder="Enter your email" required><br>
  <input type="text" id="phone" placeholder="Enter your phone number" required><br>
  <button onclick="submitApplication()">Check Status</button>

  <div id="result"></div>

<script>
  async function submitApplication() {
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone").value.trim();

    try {
      const response = await fetch("https://prod-77.southeastasia.logic.azure.com:443/workflows/3dcf20be6af641a4b49eb48727473a47/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uVigg-lTLRaUgLgUdGUnqCt9-TWJC7E7c8ryTjLC0Hw", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, phone })
      });

      // If response is not OK, log the status
      if (!response.ok) {
        console.error("Fetch error: HTTP status", response.status);
        document.getElementById("result").innerHTML = `<p style="color:red;">Error: HTTP status ${response.status}</p>`;
        return;
      }

      const data = await response.json();
      console.log("Full response data:", data); // Debug output

      // Check if 'body' field exists and is a string
      if (!data.body || typeof data.body !== "string") {
        console.error("Invalid data.body:", data.body);
        document.getElementById("result").innerHTML = `<p style="color:red;">Error: Invalid response body.</p>`;
        return;
      }

      // Try to parse the 'body' as JSON
      let resultsArray;
      try {
        resultsArray = JSON.parse(data.body);
      } catch (parseError) {
        console.error("JSON parsing error:", parseError);
        document.getElementById("result").innerHTML = `<p style="color:red;">Error: Could not parse response body as JSON.</p>`;
        return;
      }

      // Log the parsed results
      console.log("Parsed results array:", resultsArray);

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = ""; // Clear previous results

      if (Array.isArray(resultsArray) && resultsArray.length > 0) {
        resultsArray.forEach(entry => {
          const entryDiv = document.createElement("div");
          entryDiv.className = "entry";
          entryDiv.innerHTML = `
            <p><strong>Name:</strong> ${entry.name ?? 'N/A'}</p>
            <p><strong>Phone:</strong> ${entry.phone ?? 'N/A'}</p>
            <p><strong>Email:</strong> ${entry.email ?? 'N/A'}</p>
            <p><strong>Status:</strong> ${entry.status ?? 'N/A'}</p>
            <p><strong>Referral:</strong> ${entry.referral ?? 'N/A'}</p>
          `;
          resultDiv.appendChild(entryDiv);
        });
      } else {
        resultDiv.innerHTML = `<p style="color:red;">No applications found.</p>`;
      }
    } catch (error) {
      console.error("Unexpected error:", error);
      document.getElementById("result").innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
    }
  }
</script>

</body>
</html>
